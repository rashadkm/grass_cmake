.TH s.surf.3d
.SH NAME
\fIs.surf.3d\fR \-interpolation and topographic analysis from given 
3-dimentional site data to \fBgrid3 \fR format using spline with tension

.br
.SH SYNOPSIS
.B s.surf.3d
.br
\fBs.surf.3d help\fR
.br
\fBs.surf.3d \fR \fBinput = name\fR [\fBcellinp = name\fR] \fBz_orig = val\fR
\fBtb_res = val\fR \fBn_levs = val\fR [\fBtension = val\fR] [\fBsmooth = val\fR]
[\fBmaskmap = name\fR] [\fBsegmax = val\fR] [\fBdmin = val\fR] 
[\fBnpmin = val\fR] [\fBwmult = val\fR] [\fBzmult = val\fR] 
[\fBcellout = name\fR] [\fBelev = name\fR] [\fBgradient = name\fR] 
[\fBaspect1 = name\fR] [\fBaspect2 = name\fR] [\fBncurv = name\fR]
[\fBgcurv = name\fR] [\fBmcurv = name\fR]

.SH DESCRIPTION
\fIs.surf.3d\fR

.br
\fIs.surf.3d\fR interpolates the values to 3-dimentional grid  from point data
(climatic stations, drill holes etc.)
given in a sites file named \fIinput\fR. Output grid3 file
is \fIelev\fR.
The 3-dimentional gris is given by the current region as well as
options \fBz_orig, tb_res, n_levs\fR which specify the third dimention
of the grid.
If the options \fBcellinp\fR and \fBcellout\fR are specified 
then the output raster file \fBcellout\fR contains crossection of
interpolated volume with surface defined by input cell file \fBcellinp\fR.
As an option, simultaneously with interpolation,
topographic parameters gradient, both aspects, change of gradient,
Gaussian curvature, or mean curvature are computed and saved as 
grid3 file as specified by the options
\fIgradient, aspect1, aspect2, ncurv, gcurv, mcurv\fR respectively.
.LP
At first, data points are checked for identical points and points that are
closer to each other than given \fIdmin\fR are removed. 
Parameters \fIwmult\fR and \fIzmult\fR allow user to rescale the w-values 
and z-values for sites
(useful e.g. for transformation of elevations given in feet to meters,
so that the proper values of gradient and curvatures can be computed).
.LP
Regularized spline with tension is used for the interpolation.
The \fItension\fR parameter tunes the character of the resulting volume 
from thin plate to membrane.  Higher values of tension parameter 
reduce the overshoots that can appear in volumes with
rapid change of gradient.
For noisy data, it is possible to define a smoothing parameter, \fIsmooth\fR.
With the smoothing parameter set to zero (\fIsmooth=0\fR) the resulting
volume passes exactly through the data points. 
.LP
User can define a raster file named \fImaskmap\fR,
which will be used as a mask. The interpolation
is skipped for 3-dimentional cells whose 2-dimentional projection 
has zero value in mask. Zero values
will be assigned to these cells in all output grid3 files.
.LP
If the number of given points is
greater than 400, segmented processing is  used.
The region is split into 3-dimentional "box" segments, each having less than
\fIsegmax\fR points  and interpolation is performed on each
segment of the region. To ensure the smooth connection of segments
the interpolation function for each segment is computed using the points
in given segment and the points in its neighborhood. The minimum
number of points taken for interpolation is controlled by 
\fInpmin\fR , the value of which must be larger than \fIsegmax\fR and less
than 400.  This limit of 400 was selected
to ensure the numerical stability and efficiency of the algorithm.

.SH OPTIONS
The user can run this program either interactively or non-interactively.
The program will be run non-interactively if the user specifies
program arguments and flag settings on the command line using the form:
.LP
.RS
\fBs.surf.3d \fR \fBinput = name\fR [\fBcellinp = name\fR] \fBz_orig = val\fR
\fBtb_res = val\fR \fBn_levs = val\fR [\fBtension = val\fR] [\fBsmooth = val\fR]
[\fBmaskmap = name\fR] [\fBsegmax = val\fR] [\fBdmin = val\fR] 
[\fBnpmin = val\fR] [\fBwmult = val\fR] [\fBzmult = val\fR] 
[\fBcellout = name\fR] [\fBelev = name\fR] [\fBgradient = name\fR] 
[\fBaspect1 = name\fR] [\fBaspect2 = name\fR] [\fBncurv = name\fR]
[\fBgcurv = name\fR] [\fBmcurv = name\fR]

.RE
.LP
Alternately, the user can simply type \fBs.surf.3d\fR on the command line
without program arguments.  In this case, the user will be prompted for
parameter values and flag settings using the standard GRASS parser interface
described in the manual entry for \fIparser\fR.

.LP
\fBParameters:\fR
.IP \fBinput\*=\fIname\fR 18 
Use the existing site file \fIname\fR as input.
.IP \fBcellinp\*=\fIname\fR 18 
Use the existing raster file \fIname\fR as an intersecting surface.
.IP \fBz_orig\*=\fIval\fR 18 
Define \fIval\fR to be the "bottom" of the output grid.
.IP \fBtb_res\*=\fIval\fR 18 
Define \fIval\fR to be the "top-bottom" resolution of the output grid.
.IP \fBn_levs\*=\fIval\fR 18 
Define \fIval\fR to be the number of levels in the output grid.
.IP \fBtension\*=\fIval\fR 18 
Set tension to \fIval\fR .
Default value is 40, appropriate for smooth surfaces.
.IP \fBsmooth\*=\fIval\fR 18
Default value is 0, no smoothing is performed.
.IP \fBmaskmap\*=\fIname\fR 18 
Use the existing raster file \fIname\fR as a mask.
.IP \fBsegmax\*=\fIval\fR 18 
Set max number of points per segment to \fIval\fR.
Default value is 40.
.IP \fBdmin\*=\fIval\fR 18 
Set min distance between points to \fIval\fR.
Default value is set to 0.5grid cell size.
.IP \fBnpmin\*=\fIval\fR 18 
Set min number of points for interpolation to \fIval\fR.
Default value is 100, for data with heterogeneous spatial
distribution higher value is suggested (see notes).
.IP \fBzmult\*=\fIval\fR 18 
Convert z-values using conversion factor \fIval\fR.
Default value is 1.
.IP \fBwmult\*=\fIval\fR 18 
Convert w-values using conversion factor \fIval\fR.
Default value is 1.
.IP \fBcellout\*=\fIname\fR 18 
Output crossection surface to raster file named  \fIname\fR.
.IP \fBelev\*=\fIname\fR 18 
Output elevation values to grid3 file named  \fIname\fR.
.IP \fBgradient\*=\fIname\fR 18 
Output slope values to grid3 file named  \fIname\fR.
.IP \fBaspect1\*=\fIname\fR 18 
Output aspect1 values to grid3 file named  \fIname\fR.
.IP \fBaspect2\*=\fIname\fR 18 
Output aspect2 values to grid3 file named  \fIname\fR.
.IP \fBncurv\*=\fIname\fR 18 
Output change of gradient values to grid3 file named  \fIname\fR.
.IP \fBgcurv\*=\fIname\fR 18 
Output Gaussian curvature values to grid3 file named  \fIname\fR.
.IP \fBmcurv\*=\fIname\fR 18 
Output mean curvature values to grid3 file named  \fIname\fR.

.SH NOTES
.I s.surf.tps.3d
uses regularized spline with tension for interpolation from point
data (as described in Mitasova and Mitas, submitted to Mathematical
Geology.). The implementation
has an improved segmentation procedure based on octtrees
which enhances the efficiency for large data sets.
files.
.LP
Topographic parameters are computed directly from the interpolation 
function so that the important relationships between these parameters 
are preserved.
Original values of curvatures are multiplied by 100000, to conform with
GRASS integer raster files. Therefore any curvature lower than
0.00001 will be zero.  
.LP
The program gives warning when significant overshoots appear and higher
tension should be used.
However, with tension too high the resulting volume changes its behavior to
membrane( rubber sheet stretched over the data points resulting
in a peak in each given point and everywhere else the volume goes 
rapidly to trend).
With smoothing parameter greater than zero the volume will not pass
through the data points and the higher the parameter the closer the
volume will be to the trend. For theory on smoothing with splines
see Talmi and Gilat, 1977 or  Wahba, 1990.
.LP
If a visible connection of segments appears, the program should be rerun with
higher \fInpmin\fR to get more points from the neighborhood of given segment.
.LP
If the number of points in a site file is less then 400, 
\fIsegmax\fR should be set to 400 so that segmentation is not performed 
when it is not necessary.
.LP
The program gives warning when user wants to interpolate outside the
"box" given by minimum and maximum coordinates in site file, zoom into
the area where the points are is suggested in this case.
.LP
For large data sets (thousands of data points) it 
is suggested to zoom into a smaller representative area
and test whether the parameters chosen (e.g. defaults) are appropriate.

.LP
The user must run \fIg.region\fR before the program to set the region for interpolation. 
.SH "SEE ALSO"
.I "g.region, s.surf.tps, s.surf.cr.3d"
.SH "AUTHOR"
\fIOriginal version of program (in FORTRAN)\fR:
.br
Helena Mitasova,
US Army CERL, Champaign, Illinois
.br
Lubos Mitas, NCSA, University of Illinois at Urbana
Champaign, Illinois
Institute of Physics, Bratislava, Czechoslovakia
.LP
\fIModified program (translated to C, adapted for GRASS , segmentation procedure)\f
R:
.br
Irina Kosinovsky, US Army CERL
.br
Dave Gerdes, US Army CERL
.br
.SH "REFERENCES"
.LP
Hutchinson, M. K. and  Gessler, P. E., 1993. Splines: More than just a smooth
interpolator, \fIGeoderma\fR.
.br
.LP
Mitasova, H. and Mitas, L., 1993. Interpolation by regularized spline with
tension: I. Theory and implementation, \fIMathematical Geology\fR No.25 p.641-656.
.br

.LP
Mitasova, H. and Hofierka, L., 1993.  Interpolation by regularized spline with
tension: II. Application to terrain modeling and surface geometry analysis,
\fIMathematical Geology\fR No.25 p.657.
.br

.LP
Mitasova, H., 1993. Surfaces and modeling, \fIGRASSclippings\fR, v.6, No.3
(winter), pp 16-18, No.4 (spring).
.br

.LP
Talmi, A. and Gilat, G., 1977. Method for smooth approximation of data,
\fIJournal of Computational Physics\fR, 23, pp 93-123.
.br

.LP
Wahba, G., 1990. Spline models for observational data, CNMS-NSF Regional
Conference series in applied mathematics, 59, SIAM, Philadelphia,
Pennsylvania.


